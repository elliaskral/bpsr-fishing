<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Overlay Window</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      html, body {
          width: 100%;
          height: 100%;
          margin: 0;
          padding: 0;
          background: transparent !important;
}    </style>
  </head>
  <body class="text-white !bg-gray-900 text-center font-sans w-full h-full relative border !border-gray-700">

      <!-- Full horizontal panel -->
      <div class="flex items-center gap-2 bg-black bg-opacity-30 rounded p-2 w-full h-full">

        <!-- Status Indicator + Timer -->
        <div class="flex flex-col items-center gap-1 min-w-[70px]">
          <div id="status-indicator"
            class="w-4 h-4 rounded-full bg-gray-500 border border-gray-400"></div>
          <p id="status-text" class="text-xs text-gray-300 m-0">Stopped</p>
          <p id="fishing-timer" class="text-xs text-gray-200 m-0">00:00:00</p>
        </div>

        <!-- Start Button -->
        <button id="start-btn"
          class="flex flex-col items-center px-2 py-1 bg-green-700 hover:bg-green-800 rounded text-xs">
          <span>Start</span>
          <span class="text-[10px] text-gray-200">S</span>
        </button>

        <!-- Stop Button -->
        <button id="stop-btn"
          class="flex flex-col items-center px-2 py-1 bg-red-700 hover:bg-red-800 rounded text-xs">
          <span>Stop</span>
          <span class="text-[10px] text-gray-200">X</span>
        </button>

      </div>

      <!-- Minimize / Close Buttons -->
      <div class="absolute top-1 right-1 flex gap-1">
        <button id="minimize-btn"
          class="px-2 py-1 hover:bg-[rgba(255,255,255,0.05)] rounded text-xs">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none"
            viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
            class="w-4 h-4">
            <path stroke-linecap="round" stroke-linejoin="round" d="M5 12h14" />
          </svg>
        </button>
        <button id="close-btn"
          class="px-2 py-1 hover:bg-[rgba(255,255,255,0.05)]  rounded text-xs">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none"
            viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
            class="w-4 h-4">
            <path stroke-linecap="round" stroke-linejoin="round"
              d="M6 18 18 6M6 6l12 12" />
          </svg>
        </button>
      </div>

    </div>
<script>
  const indicator = document.getElementById('status-indicator');
  const statusText = document.getElementById('status-text');
  const timerText = document.getElementById('fishing-timer');

let fishingStartTime = null;
let elapsedTime = 0; // milliseconds already counted
let timerInterval = null;

function setStatus(state) {
  if (state === 'running') {
    indicator.className = 'w-4 h-4 rounded-full bg-green-500 border border-green-300';
    statusText.textContent = 'Running';
    statusText.className = 'text-xs text-green-300';
    if (!timerInterval) {
      fishingStartTime = new Date();
      timerInterval = setInterval(updateTimer, 1000);
    }
  } else if (state === 'stopped') {
    indicator.className = 'w-4 h-4 rounded-full bg-red-500 border border-red-300';
    statusText.textContent = 'Stopped';
    statusText.className = 'text-xs text-red-300';
    if (timerInterval) {
      clearInterval(timerInterval);
      timerInterval = null;
      // Save elapsed time
      elapsedTime += new Date() - fishingStartTime;
    }
  }
}

function updateTimer() {
  if (!fishingStartTime) return;
  const diff = elapsedTime + (new Date() - fishingStartTime);
  const hours = Math.floor(diff / 3600000);
  const mins = Math.floor((diff % 3600000) / 60000);
  const secs = Math.floor((diff % 60000) / 1000);
  timerText.textContent = `${String(hours).padStart(2,'0')}:${String(mins).padStart(2,'0')}:${String(secs).padStart(2,'0')}`;
}


  // Expose a global function for Python to toggle UI state
  window.toggleBotStatus = function(state) {
    setStatus(state);
  };

  // Button actions
  document.getElementById('start-btn').onclick = () => {
    window.pywebview.api.start_bot().then(() => setStatus('running'));
  };

  document.getElementById('stop-btn').onclick = () => {
    window.pywebview.api.stop_bot().then(() => setStatus('stopped'));
  };

  document.getElementById('minimize-btn').onclick = () => {
     window.pywebview.api.minimize_window();
  };

  document.getElementById('close-btn').onclick = () => {
     window.pywebview.api.close_window();
  };

</script>

  </body>
</html>
